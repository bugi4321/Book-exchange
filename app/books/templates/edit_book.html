{% extends "base.html" %}
{% block title %}Uredi knjigu{% endblock %}

{% block content %}
<div class="container my-5">
    <h2 class="fw-bold text-center mb-4">Uredi oglas</h2>

    <form method="POST" enctype="multipart/form-data" 
          class="p-4 shadow rounded" style="background:#f8f3ec;">
        
        {{ form.hidden_tag() }}

        <div class="mb-3">
            {{ form.title.label }}
            {{ form.title(class="form-control", placeholder="Naslov knjige") }}
        </div>

        <div class="mb-3">
            {{ form.author.label }}
            {{ form.author(class="form-control", placeholder="Autor") }}
        </div>

        <div class="mb-3">
            {{ form.description.label }}
            {{ form.description(class="form-control", id="markdown-editor", rows="10") }}
            <small class="text-muted">
                <i class="fa-solid fa-info-circle"></i> 
                Podržava Markdown formatting
            </small>
        </div>

        {% if book.image %}
        <div class="mb-3">
            <label class="form-label">Trenutna slika:</label>
            <img src="{{ url_for('static', filename='uploads/' ~ book.image) }}" 
                 class="img-fluid rounded" 
                 style="max-width: 200px;">
        </div>
        {% endif %}

        <div class="mb-3">
            {{ form.image.label }}
            {{ form.image(class="form-control") }}
            <small class="text-muted">Ostavite prazno ako ne želite mijenjati sliku</small>
        </div>

        <div class="d-flex gap-2">
            {{ form.submit(class="btn text-white flex-fill", style="background-color:#5a3e2b;") }}
            <a href="{{ url_for('books.list_books') }}" class="btn btn-secondary flex-fill">Odustani</a>
        </div>
    </form>

</div>

<!-- EasyMDE CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/easymde/2.18.0/easymde.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/easymde/2.18.0/easymde.min.js"></script>

<script>
    // Inicijalizacija EasyMDE editora
    const easyMDE = new EasyMDE({
        element: document.getElementById('markdown-editor'),
        spellChecker: false,
        placeholder: "Unesite opis knjige...",
        status: ["lines", "words", "cursor"],
        toolbar: [
            "bold", "italic", "heading", "|",
            "quote", "unordered-list", "ordered-list", "|",
            "link", "image", "|",
            "preview", "side-by-side", "fullscreen", "|",
            "guide"
        ]
    });
</script>

<style>
    .EasyMDEContainer {
        border-radius: 8px;
    }
    
    .CodeMirror {
        border: 1px solid #ddd;
        border-radius: 8px;
        min-height: 300px;
        font-size: 14px;
    }
    
    .editor-toolbar {
        border-radius: 8px 8px 0 0;
        background: #f5f5f5;
    }
    
    .editor-preview, .editor-preview-side {
        background: #fff;
        padding: 15px;
    }
</style>

{% endblock %}