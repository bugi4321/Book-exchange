{% extends "base.html" %}
{% block title %}{{ book.title }}{% endblock %}

{% block content %}

<div class="container my-5">
    <!-- Navigacija natrag -->
    <a href="{{ url_for('books.list_books') }}" class="btn btn-outline-secondary mb-4">
        <i class="fa-solid fa-arrow-left"></i> Natrag na sve knjige
    </a>

    <div class="card shadow-lg">
        <div class="card-body p-4">
            
            <!-- Naslov knjige -->
            <h1 class="fw-bold mb-3">{{ book.title }}</h1>
            
            <!-- Autor -->
            <p class="text-muted fs-5 mb-4">
                <i class="fa-solid fa-user-pen"></i> Autor: <strong>{{ book.author }}</strong>
            </p>

            <hr>

            <!-- Slika knjige -->
            {% if book.image %}
            <div class="text-center my-4">
                <img src="{{ url_for('static', filename='uploads/' ~ book.image) }}" 
                     class="img-fluid rounded shadow" 
                     style="max-width: 500px;">
            </div>
            {% endif %}

            <!-- Opis knjige (Markdown → HTML) -->
            <div class="book-description-full mt-4">
                <h4 class="fw-bold mb-3">Opis:</h4>
                {{ book.description_html|safe }}
            </div>

            <hr class="my-4">

            <!-- Info o objavi -->
            <div class="text-muted small">
                <p class="mb-1">
                    <i class="fa-solid fa-circle-user"></i> 
                    Objavio: <strong>{{ book.first_name }}</strong>
                </p>
                <p class="mb-1">
                    <i class="fa-solid fa-envelope"></i> 
                    Kontakt: <a href="mailto:{{ book.owner_email }}">{{ book.owner_email }}</a>
                </p>
                {% if book.created_at %}
                <p class="mb-0">
                    <i class="fa-solid fa-calendar"></i> 
                    Objavljeno: {{ book.created_at.strftime('%d.%m.%Y') }}
                </p>
                {% endif %}
            </div>

            <!-- Akcije  -->
            {% if current_user.is_authenticated %}
                {% if current_user.role == "admin" or current_user.id == book.owner_id %}
                <div class="d-flex gap-2 mt-4">
                    <a href="{{ url_for('books.edit_book', book_id=book._id) }}" 
                       class="btn btn-warning">
                        <i class="fa-solid fa-edit"></i> Uredi oglas
                    </a>

                    <form method="POST" 
                          action="{{ url_for('books.delete_book', book_id=book._id) }}"
                          onsubmit="return confirm('Sigurno želiš obrisati ovu knjigu?');">
                        <button class="btn btn-danger">
                            <i class="fa-solid fa-trash"></i> Obriši oglas
                        </button>
                    </form>
                </div>
                {% endif %}
            {% endif %}

        </div>
    </div>
</div>

<style>
    
    .book-description-full {
        line-height: 1.8;
        font-size: 1.05rem;
    }
    
    .book-description-full h1,
    .book-description-full h2,
    .book-description-full h3 {
        margin-top: 1.5rem;
        margin-bottom: 1rem;
        font-weight: 600;
    }
    
    .book-description-full p {
        margin-bottom: 1rem;
    }
    
    .book-description-full ul,
    .book-description-full ol {
        margin-left: 2rem;
        margin-bottom: 1rem;
    }
    
    .book-description-full blockquote {
        border-left: 4px solid #5a3e2b;
        padding-left: 1rem;
        margin: 1.5rem 0;
        font-style: italic;
        color: #666;
    }
    
    .book-description-full code {
        background-color: #f4f4f4;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
    }
    
    .book-description-full pre {
        background-color: #f4f4f4;
        padding: 1rem;
        border-radius: 8px;
        overflow-x: auto;
    }
    
    .book-description-full pre code {
        background: none;
        padding: 0;
    }
    
    .book-description-full a {
        color: #5a3e2b;
        text-decoration: underline;
    }
    
    .book-description-full a:hover {
        color: #704c36;
    }
    
    .book-description-full img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 1rem 0;
    }
    
    .book-description-full table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
    }
    
    .book-description-full table th,
    .book-description-full table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    
    .book-description-full table th {
        background-color: #5a3e2b;
        color: white;
        font-weight: 600;
    }
</style>

{% endblock %}